# Планирование: анализ, идентификация проблем и поиск решений

## 1. Проблемные места

1. **MES перегружен**: 
   - Сложные расчёты занимают до 30 минут.
   - Интерфейс операторов тормозит, несмотря на фильтры и пагинацию.
2. **Нет трейсинга**:
   - Невозможно отследить путь заказа, понять, где он застрял.
3. **Нет мониторинга**:
   - Отсутствуют метрики RabbitMQ, API, CPU/Memory, RPS, ошибки.
4. **Низкая масштабируемость**:
   - Один инстанс на каждое приложение и БД.
5. **Нет кеширования**:
   - Данные дашборда и расчёты не кешируются.
6. **Слабый CI/CD**:
   - Ручной деплой, нет автоматических E2E-тестов.
7. **Перегрузка от API-партнёров**:
   - Нет защиты от большого количества запросов.

## 2. Инициативы по улучшению

| №  | Инициатива                   | Описание                                     |
|----|------------------------------|----------------------------------------------|
| 1  | Внедрение трейсинга          | Отслеживание пути заказа.                    |
| 2  | Централизованное логирование | Логи по заказам, ошибкам и статусам.         |
| 3  | Мониторинг                   | Метрики RabbitMQ, API, ресурсы, ошибки.      |
| 4  | Кеширование в MES            | Кеш дашборда и расчётов.                     |
| 5  | Масштабирование MES          | Выделение воркеров, горизонтальный скейлинг. |
| 6  | Очередь API-запросов         | Throttling, rate limiting.                   |
| 7  | Авто E2E-тесты               | Автоматизация регрессии.                     |
| 8  | Вынесение расчётов           | Отдельный сервис или очередь для расчётов.   |
| 9  | CI/CD на прод                | Автоматизация релизов.                       |
| 10 | Ограничение API-партнёров    | Квоты, изоляция.                             |

## 3. Приоритизация

**Топ-3 приоритета:**
1. **Трейсинг** — критичен для расследования зависаний заказов.
2. **Мониторинг** — даст контроль над состоянием системы.
3. **Кеширование MES** — ускорит интерфейс и снизит нагрузку.

## 4. Целевая архитектура через 6 месяцев

- Есть трейсинг (Jaeger/Tempo), логирование (Loki).
- MES разделён на API и воркеры.
- Кеш дашборда и расчётов (Redis, например).
- Работает мониторинг (Prometheus + Grafana).
- API защищён лимитами и очередями.
- E2E тесты покрывают бизнес-флоу.
- CI/CD автоматизирован.
